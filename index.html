<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <style>

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
    }

    .point {
      border: 1px solid red;
      width: 25px;
      height: 25px;
    }

    .zoomer {
      border: 0 solid blue;
    }

    #os {
      width: 100vw;
      height: 100vh;
    }

    .label {
      transition: opacity .5s;
      position: absolute;
      opacity: 0.9;
      border: 1px solid orange;
    }

    .label.focus {
      opacity: 0;
    }

    .point {
      width: 10px;
      height: 10px;
    }

    .point--start {
      border: 1px solid red;
    }

    .point--end {
      border: 1px solid blue;
    }

    line {
      stroke: rgba(30, 30, 30, 0.3);
      stroke-width: 1.1;
    }

    circle {
      fill: #66CCF2;
    }

    text {
      font-family: Arial;
      font-size: 15px;
      fill: #000;
      pointer-events: none;
    }

    svg:hover circle {
      fill: #ccc;
    }

  </style>

</head>
<body>
  
  <div id="os"></div>

  <script src="seadragon/openseadragon.js"></script>
  <script>
    var viewer = OpenSeadragon({
      id: 'os',
      prefixUrl: 'seadragon/images/',
      showFullPageControl: false,
      animationTime: 1.75,
      zoomPerClick: 1.2,
      immediateRender: true,
      tileSources: ['tiles/2015.1.35.xml']
    });

    var el = function (el, className) {
      el = document.createElement(el);
      el.className = className;
      return el;
    }

    var labels = [];

    viewer.addHandler('open', function () {

      var vw = viewer.source.width,
          vh = viewer.source.height,
          offset = 50;

      var hotspots = [
        { x1: 0, y1: 0, x2: offset, y2: offset },
        { x1: vw, y1: 0, x2: vw - offset, y2: offset },
        { x1: vw, y1: vh, x2: vw - offset, y2: vh - offset },
        { x1: 0, y1: vh, x2: offset, y2: vh - offset },
        { x1: 1600, y1: 1770, x2: 2000, y2: 1350 }
      ];

      labels = [];

      var radius = 15;
      var zoomDepth = 0.15;

      hotspots.forEach(function (hotspot, index) {

        var x1 = hotspot.x1, y1 = hotspot.y1,
            x2 = hotspot.x2, y2 = hotspot.y2;

        var height = Math.abs(y1 - y2),
            width = Math.abs(x1 - x2);

        var left = x1, 
            top = y1;

        var linePointingRight = x1 < x2,
            linePointingDown = y1 < y2;
        
        if (!linePointingDown) top -= height;
        if (!linePointingRight) left -= width;  
        
        height += radius * 2;
        width += radius * 2;
        top -= radius;
        left -= radius;
        
        var cx = linePointingRight ? width - radius : 0 + radius,
            cy = linePointingDown ? height - radius : 0 + radius;

        var lineStartX = linePointingRight ? 0 : width,
            lineStartY = linePointingDown ? 0 : height;

        var label = document.createElementNS('http://www.w3.org/2000/svg', 'svg'),
            line = document.createElementNS('http://www.w3.org/2000/svg', 'line'),
            circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle'),
            text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            
        label.classList.add('label');
        label.setAttribute('height', height);
        label.setAttribute('width', width);

        line.setAttribute('x1', lineStartX);
        line.setAttribute('y1', lineStartY);
        line.setAttribute('x2', cx);
        line.setAttribute('y2', cy);  
        label.appendChild(line);

        circle.setAttribute('cx', cx);
        circle.setAttribute('cy', cy);
        circle.setAttribute('r', radius);
        label.appendChild(circle);

        text.setAttribute('x', cx);
        text.setAttribute('y', cy + 5);
        text.setAttribute('text-anchor', 'middle');
        text.innerHTML = index + 1;
        label.appendChild(text);

        var rx = x1 / viewer.source.width,
            ry = y1 / viewer.source.height / viewer.source.aspectRatio;

        var zoomBoundaries = new OpenSeadragon.Rect(
          rx - (zoomDepth / 2),
          ry - (zoomDepth / 2),
          zoomDepth,
          zoomDepth
        );

        circle.addEventListener('click', function () {
          viewer.viewport.fitBounds(zoomBoundaries);
        });

        
        var start = new OpenSeadragon.Point(
          x2 / viewer.source.width,
          y2 / viewer.source.height / viewer.source.aspectRatio
        );

        var end = new OpenSeadragon.Point(
          x1 / viewer.source.width,
          y1 / viewer.source.height / viewer.source.aspectRatio
        );

        viewer.addOverlay(el('div', 'point point--start'), start, 0);
        viewer.addOverlay(el('div', 'point point--end'), end, 0);

        var rect = new OpenSeadragon.Rect(
          x1 / viewer.source.width,
          y1 / viewer.source.height / viewer.source.aspectRatio,
          width,
          height
        )

        viewer.addOverlay(label, rect, 0, function (position, size, element) {
          if (!linePointingRight) position.x -= width;
          if (!linePointingDown) position.y -= height;
          element.style.top = position.y + 'px';
          element.style.left = position.x + 'px';
        });

        labels.push(label);

      });
      
    });



  </script>
</body>
</html>